#
# Author: Gina Jiménez
# --------------------------------------------------
# rent_airbnb/grafs/src/grafs.r
if(!require(pacman))install.packages("pacman")
pacman::p_load(tidyverse, extrafont)
extrafont::loadfonts(quiet=T)
Sys.setlocale("LC_ALL", "es_ES.UTF-8")
options(scipen = 9999)
#### Tema  ####
source(files$tema)
#
# Author: Gina Jiménez
# --------------------------------------------------
# rent_airbnb/grafs/src/grafs.r
if(!require(pacman))install.packages("pacman")
pacman::p_load(tidyverse, extrafont)
extrafont::loadfonts(quiet=T)
Sys.setlocale("LC_ALL", "es_ES.UTF-8")
options(scipen = 9999)
#### Tema  ####
source(here("descriptives/src/theme.R"))
pacman::p_load(tidyverse, extrafont, here)
#### Tema  ####
source(here("descriptives/src/theme.R"))
#### Tema  ####
source(here("grafs/src/theme.R"))
#### Tema  ####
source(here("grafs/src/theme.R"))
data <- readRDS(files$airbnbs)
files <- list(airbnbs = here("import-clean/out/airbnbs.rds"),
buildings = here("import-clean/out/buildings.rds"))
data <- readRDS(files$airbnbs)
View(data)
View(data)
data_b <- readRDS(files$buildings)
View(data_b)
names(Data)
names(data_b)
data_b <- readRDS(files$buildings)%>%
mutate(dif=rsunitslatest-rsunits2007,
perdio=ifelse(dif<0, 1, 0))
table(data_b)
table(data_b$perdio)
data_b <- readRDS(files$buildings)%>%
mutate(dif=rsunitslatest-rsunits2007,
perdio=ifelse(dif<0, 1, 0))%>%
filter(perdio==1)
View(data_b)
View(data_b)
View(data_b)
View(data_b)
names(data_b)
data_b <- st_as_sf(data_b, coords = c("lat", "lng"), crs = 28992, agr = "constant")
pacman::p_load(tidyverse, extrafont, here, sf)
data_b <- st_as_sf(data_b, coords = c("lat", "lng"), crs = 28992, agr = "constant")
View(data_b)
str(data_b)
data_b <- readRDS(files$buildings)%>%
mutate(dif=rsunitslatest-rsunits2007,
perdio=ifelse(dif<0, 1, 0))%>%
filter(perdio==1)%>%
filter(!is.na(lng))
View(files)
data_b <- st_as_sf(data_b, coords = c("lat", "lng"), crs = 28992, agr = "constant")
plot(data_b)
View(data)
View(data)
names(data)
#
# Author: Gina Jiménez
# --------------------------------------------------
# rent_airbnb/grafs/src/grafs.r
if(!require(pacman))install.packages("pacman")
pacman::p_load(tidyverse, extrafont, here, sf)
extrafont::loadfonts(quiet=T)
Sys.setlocale("LC_ALL", "es_ES.UTF-8")
options(scipen = 9999)
files <- list(airbnbs = here("import-clean/out/airbnbs.rds"),
))
#
# Author: Gina Jiménez
# --------------------------------------------------
# rent_airbnb/grafs/src/grafs.r
if(!require(pacman))install.packages("pacman")
pacman::p_load(tidyverse, extrafont, here, sf)
extrafont::loadfonts(quiet=T)
Sys.setlocale("LC_ALL", "es_ES.UTF-8")
options(scipen = 9999)
files <- list(airbnbs = here("import-clean/out/airbnbs.rds"),
buildings = here("import-clean/out/buildings.rds"))
#
# Author: Gina Jiménez
# --------------------------------------------------
# rent_airbnb/grafs/src/grafs.r
if(!require(pacman))install.packages("pacman")
pacman::p_load(tidyverse, extrafont, here, sf)
extrafont::loadfonts(quiet=T)
Sys.setlocale("LC_ALL", "es_ES.UTF-8")
options(scipen = 9999)
files <- list(airbnbs = here("import-clean/out/airbnbs.rds"),
buildings = here("import-clean/out/buildings.rds"))
#### Tema  ####
source(here("grafs/src/theme.R"))
airbnbs <- readRDS(files$airbnbs)
buildings <- readRDS(files$buildings)%>%
mutate(dif=rsunitslatest-rsunits2007,
perdio=ifelse(dif<0, 1, 0))%>%
filter(perdio==1)%>%
filter(!is.na(lng))
View(buildings)
buildings <- st_as_sf(buildings, coords = c("lat", "lng"), crs = 28992, agr = "constant")
airbnbs <- st_as_sf(airbnbs, coords = c("lat", "lng"), crs = 28992, agr = "constant")
View(airbnbs)
names(airbnbs)
airbnbs <- st_as_sf(airbnbs, coords = c("latitude", "longitude"), crs = 28992, agr = "constant")
plot(airbnbs)
aver <- st_intersects(buildings, airbnbs)
plot(aver)
View(aver)
View(airbnbs)
View(aver)
#Make buildings that have lost rent controlled apartments buffers
buildigns <- st_buffer(buildings, 50)
plot(buildigns)
str(buildings)
View(buildigns)
names(buildings)
#Make buildings that have lost rent controlled apartments buffers
aver <- select(buildings, geometry)
plot(aver)
buildings <- readRDS(files$buildings)%>%
mutate(dif=rsunitslatest-rsunits2007,
perdio=ifelse(dif<0, 1, 0))%>%
filter(perdio==1)%>%
filter(!is.na(lng))%>%
mutate(id = 1:nrow(buildings))
View(buildings)
#
# Author: Gina Jiménez
# --------------------------------------------------
# rent_airbnb/grafs/src/grafs.r
rs(list=ls())
#
# Author: Gina Jiménez
# --------------------------------------------------
# rent_airbnb/grafs/src/grafs.r
rm(list=ls())
if(!require(pacman))install.packages("pacman")
pacman::p_load(tidyverse, extrafont, here, sf)
extrafont::loadfonts(quiet=T)
Sys.setlocale("LC_ALL", "es_ES.UTF-8")
options(scipen = 9999)
files <- list(airbnbs = here("import-clean/out/airbnbs.rds"),
buildings = here("import-clean/out/buildings.rds"))
#### Tema  ####
source(here("grafs/src/theme.R"))
airbnbs <- readRDS(files$airbnbs)
buildings <- readRDS(files$buildings)%>%
mutate(dif=rsunitslatest-rsunits2007,
perdio=ifelse(dif<0, 1, 0))%>%
filter(perdio==1)%>%
filter(!is.na(lng))%>%
mutate(id = 1:nrow(buildings))
#
# Author: Gina Jiménez
# --------------------------------------------------
# rent_airbnb/grafs/src/grafs.r
rm(list=ls())
if(!require(pacman))install.packages("pacman")
pacman::p_load(tidyverse, extrafont, here, sf)
extrafont::loadfonts(quiet=T)
Sys.setlocale("LC_ALL", "es_ES.UTF-8")
options(scipen = 9999)
files <- list(airbnbs = here("import-clean/out/airbnbs.rds"),
buildings = here("import-clean/out/buildings.rds"))
#### Tema  ####
source(here("grafs/src/theme.R"))
airbnbs <- readRDS(files$airbnbs)
buildings <- readRDS(files$buildings)%>%
mutate(dif=rsunitslatest-rsunits2007,
perdio=ifelse(dif<0, 1, 0))%>%
filter(perdio==1)%>%
filter(!is.na(lng))
mutate(id = 1:nrow(.))
buildings <- mutate(id = 1:nrow(buildings))
#
# Author: Gina Jiménez
# --------------------------------------------------
# rent_airbnb/grafs/src/grafs.r
rm(list=ls())
if(!require(pacman))install.packages("pacman")
pacman::p_load(tidyverse, extrafont, here, sf)
extrafont::loadfonts(quiet=T)
Sys.setlocale("LC_ALL", "es_ES.UTF-8")
options(scipen = 9999)
files <- list(airbnbs = here("import-clean/out/airbnbs.rds"),
buildings = here("import-clean/out/buildings.rds"))
#### Tema  ####
source(here("grafs/src/theme.R"))
airbnbs <- readRDS(files$airbnbs)
buildings <- readRDS(files$buildings)%>%
mutate(dif=rsunitslatest-rsunits2007,
perdio=ifelse(dif<0, 1, 0))%>%
filter(perdio==1)%>%
filter(!is.na(lng))
buildings <- mutate(buildings, id = 1:nrow(buildings))
View(buildings)
build_sh <- select(buildings, id, geommetry)
buildings <- st_as_sf(buildings, coords = c("lat", "lng"), crs = 28992, agr = "constant")
build_sh <- select(buildings, id, geommetry)
names(buildings)
build_sh <- select(buildings, id, geometry)
plot(build_sh)
str(build_sh)
airbnbs <- st_as_sf(airbnbs, coords = c("latitude", "longitude"), crs = 28992, agr = "constant")
st_crs(airbnbs) = st_crs(buildings)
build_sh = st_buffer(build_sh, .5)
plot(build_sh)
build_sh = st_buffer(build_sh, .0005)
buildings <- readRDS(files$buildings)%>%
mutate(dif=rsunitslatest-rsunits2007,
perdio=ifelse(dif<0, 1, 0))%>%
filter(perdio==1)%>%
filter(!is.na(lng))
buildings <- mutate(buildings, id = 1:nrow(buildings))
buildings <- st_as_sf(buildings, coords = c("lat", "lng"), crs = 28992, agr = "constant")
build_sh <- select(buildings, id, geometry)
plot(build_sh)
build_sh = st_buffer(build_sh, .0005)
plot(build_sh)
buildings <- readRDS(files$buildings)%>%
mutate(dif=rsunitslatest-rsunits2007,
perdio=ifelse(dif<0, 1, 0))%>%
filter(perdio==1)%>%
filter(!is.na(lng))
buildings <- mutate(buildings, id = 1:nrow(buildings))
buildings <- st_as_sf(buildings, coords = c("lat", "lng"), crs = 28992, agr = "constant")
build_sh <- select(buildings, id, geometry)
plot(build_sh)
build_sh = st_buffer(build_sh, .01)
plot(build_sh)
#Bajar datos de airbns y configurarlos en la misma proyección que edificios
airbnbs <- st_as_sf(airbnbs, coords = c("latitude", "longitude"), crs = 28992, agr = "constant")
st_crs(airbnbs) = st_crs(buildings)
st_crs(airbnbs) = st_crs(build_sh)
## Vamos a mezclarlos
buff = lengths(st_intersects(airbnbs, build_sh)) > 0
sum(buff)
View(buff)
build_sh <- select(buildings, id, geometry)
build_sh = st_buffer(build_sh, .001)
plot(build_sh)
st_crs(airbnbs) = st_crs(build_sh)
## Vamos a mezclarlos
buff = lengths(st_intersects(airbnbs, build_sh)) > 0
sum(buff)
View(airbnbs)
buildings <- readRDS(files$buildings)%>%
mutate(dif=rsunitslatest-rsunits2007,
perdio=ifelse(dif<0, 1, 0))%>%
filter(perdio==1)%>%
filter(!is.na(lng))
buildings <- mutate(buildings, id = 1:nrow(buildings))
buildings <- st_as_sf(buildings, coords = c("lat", "lng"), crs = 28992, agr = "constant")
build_sh <- select(buildings, id, geometry)
build_sh = st_buffer(build_sh, .0005)
plot(build_sh)
#Bajar datos de airbns y configurarlos en la misma proyección que edificios
airbnbs <- st_as_sf(airbnbs, coords = c("latitude", "longitude"), crs = 28992, agr = "constant")
st_crs(airbnbs) = st_crs(build_sh)
## Vamos a mezclarlos
buff = lengths(st_intersects(airbnbs, build_sh)) > 0
sum(buff)
build_sh = st_buffer(build_sh, .0005)
plot(build_sh)
#Bajar datos de airbns y configurarlos en la misma proyección que edificios
airbnbs <- st_as_sf(airbnbs, coords = c("latitude", "longitude"), crs = 28992, agr = "constant")
st_crs(airbnbs) = st_crs(build_sh)
## Vamos a mezclarlos
buff = lengths(st_intersects(airbnbs, build_sh)) > 0
sum(buff)
buildings <- readRDS(files$buildings)%>%
mutate(dif=rsunitslatest-rsunits2007,
perdio=ifelse(dif<0, 1, 0))%>%
filter(perdio==1)%>%
filter(!is.na(lng))
buildings <- mutate(buildings, id = 1:nrow(buildings))
buildings <- st_as_sf(buildings, coords = c("lat", "lng"), crs = 28992, agr = "constant")
build_sh <- select(buildings, id, geometry)
build_sh = st_buffer(build_sh, .0005)
plot(build_sh)
#Bajar datos de airbns y configurarlos en la misma proyección que edificios
airbnbs <- st_as_sf(airbnbs, coords = c("latitude", "longitude"), crs = 28992, agr = "constant")
st_crs(airbnbs) = st_crs(build_sh)
## Vamos a mezclarlos
buff = lengths(st_intersects(airbnbs, build_sh)) > 0
sum(buff)
plot(pts[buff], pch=19, col="blue", add=TRUE)
plot(airbnbs[buff], pch=19, col="blue", add=TRUE)
airbnbs <- mutate(airbnbs, build=buff)
View(airbnbs)
sum(airbnbs$build)
0.0005*111
0.0005*111*1000
plot(airbnbs$build)
plot(airbnbs)
#Make buildings that have lost rent controlled apartments buffers
ggplot(data = airbnbs) +
geom_sf(aes(fill = buff))+
labs(title="Rate of calls about homeless people\n in each Zipcode",
subtitle = sprintf('%s', years[i]), fill="Total")+
tema
#Make buildings that have lost rent controlled apartments buffers
ggplot(data = airbnbs) +
geom_sf(aes(fill = buff))+
labs(title="Rate of calls about homeless people\n in each Zipcode")+
tema
table(airbnbs$buff)
table(airbnbs$build)
#Make buildings that have lost rent controlled apartments buffers
ggplot(data = airbnbs) +
geom_sf(aes(fill = build))+
labs(title="Rate of calls about homeless people\n in each Zipcode")+
tema
#Make buildings that have lost rent controlled apartments buffers
ggplot(data = airbnbs) +
geom_sf(aes(color = build))+
labs(title="Rate of calls about homeless people\n in each Zipcode")+
tema
buildings <- readRDS(files$buildings)%>%
mutate(dif=rsunitslatest-rsunits2007,
perdio=ifelse(dif<0, 1, 0))%>%
filter(perdio==1)%>%
filter(!is.na(lng))
buildings <- mutate(buildings, id = 1:nrow(buildings))
buildings <- st_as_sf(buildings, coords = c("lat", "lng"), crs = 28992, agr = "constant")
build_sh <- select(buildings, id, geometry)
build_sh = st_buffer(build_sh, .0005)
plot(build_sh)
#Bajar datos de airbns y configurarlos en la misma proyección que edificios
airbnbs <- st_as_sf(airbnbs, coords = c("latitude", "longitude"), crs = 28992, agr = "constant")
st_crs(airbnbs) = st_crs(build_sh)
## Vamos a mezclarlos
buff = lengths(st_intersects(airbnbs, build_sh)) > 0
sum(buff)
#Con ese tamaño, hay como 5115 airbnbs que parecen caer en edificios que son rent controlled
airbnbs <- mutate(airbnbs, build=buff)
View(airbnbs)
file.choose()
aver <- filter(airbnbs, build=T)
View(airbnbs)
aver <- filter(airbnbs, build==T)
View(aver)
View(build_sh)
View(buildings)
View(aver)
View(airbnbs)
airbnbs2 <- unique(airbnbs)
rm(airbnbs2)
duplicated(airbnbs$geometry)
airbnbs2 <- unique(airbnbs$geometry)
View(airbnbs2)
rm(airbnbs2)
View(aver)
write.csv(aver, here("grafs/src/base_airbnbs.csv"))
View(buildings)
